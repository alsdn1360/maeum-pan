#!/bin/sh
set -e

export PATH="$PATH:/usr/local/bin:/opt/homebrew/bin:/usr/bin"

echo "
╭─ 🔍 코드 품질 검사 진행 중...
╰─ 🔧 오류가 있으면 자동 수정됩니다.
"

if pnpm lint-staged; then
  echo "
╭─ ✅ 모든 검사 통과!
╰─ 🌟 완벽합니다. 즐거운 코딩하세요!
"
  exit 0
else
  exit_code=$?
  
  # lint-staged가 파일을 수정하여 커밋할 내용이 없어진 경우
  if [ $exit_code -eq 1 ] && git diff --cached --quiet; then
    echo "
╭─ 📝 커밋할 변경사항이 없습니다.
╰─ 🚀 변경사항을 스테이징하고 다시 커밋해주세요.
"
  else
    # 일반적인 린트 에러
    echo "
╭─ ⚠️ 린트 문제 발견!
╰─ 👀 위의 오류 메시지를 확인하고 수정해서 다시 커밋해주세요.
"
  fi
  
  exit 1
fi
